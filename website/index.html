<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AmpereLog PRO - Live Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <video autoplay muted loop playsinline class="video-bg"><source src="car-rain.mp4" type="video/mp4"></video>
    <div class="video-overlay"></div>

    <header class="top-nav">
        <div class="logo-text">AmpereLog PRO</div>
        <nav class="nav-links">
            <a href="/" class="nav-btn active">Live Dashboard</a>
            <a href="/analysis" class="nav-btn">Manual Analysis</a>
        </nav>
        <div class="status-badge disconnected" id="connStatus">ðŸ”´ Disconnected</div>
    </header>

    <div class="dashboard-container">
        <div id="alertContainer" style="margin-bottom: 20px;"></div>

        <div class="stats-grid">
            <div class="card">
                <div class="card-label">State of Charge (SOC)</div>
                <div class="value-large soc-value"><span id="socDisplay">100.0</span>%</div>
                <div class="battery-bar-container"><div class="battery-fill" id="socBar" style="width: 100%;"></div></div>
            </div>
            <div class="card">
                <div class="card-label">Voltage</div>
                <div class="value-large"><span id="voltDisplay">0.00</span>V</div>
            </div>
            <div class="card">
                <div class="card-label">Temp</div>
                <div class="value-large"><span id="tempDisplay">0.0</span>Â°C</div>
            </div>
            <div class="card">
                <div class="card-label">Time Remaining</div>
                <div class="value-large duration-value"><span id="durationDisplay">--</span><span class="unit"> Min</span></div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 30px; text-align: left;">
            <div class="card-label">Live Projected Duration Curve</div>
            <div style="height: 250px; margin-top: 15px;"><canvas id="liveChart"></canvas></div>
        </div>

        <div class="control-panel">
            <div class="control-card" style="border-color: var(--accent-green);">
                <h3 style="color: var(--accent-green);">Live AI Prediction Engine</h3>
                <input type="file" id="liveCsvFile" accept=".csv" class="nav-btn" style="width: 100%; margin-bottom: 15px;">
                
                <div id="liveMapperSection" style="display:none;">
                    <div class="mapper-grid" style="grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));">
                        <div class="map-item"><label>Time</label><select id="liveMapTime"></select></div>
                        <div class="map-item"><label>Voltage</label><select id="liveMapVolts"></select></div>
                        <div class="map-item"><label>Current</label><select id="liveMapAmps"></select></div>
                        <div class="map-item"><label>Temp</label><select id="liveMapTemp"></select></div>
                        <div class="map-item"><label>SoC %</label><select id="liveMapSoc"></select></div>
                    </div>
                    <select id="liveMType" style="margin-top:15px; width:100%">
                        <option value="fast">âš¡ Fast Model (XGBoost)</option>
                        <option value="pro">ðŸ§  Pro Model (CNN-GRU)</option>
                    </select>
                    <button class="btn-gen" style="width:100%; margin-top:15px;" onclick="trainLiveAI()">Train & Connect Live AI</button>
                </div>
                <p id="liveStatusMsg" style="margin-top:10px; font-weight:bold;"></p>
            </div>

            <div class="control-card">
                <h3>Generate EV Dataset</h3>
                <div class="input-row"><input type="number" id="minV" placeholder="Stop (9.0)"><button class="btn-gen" id="genBtn" onclick="toggleGeneration()" style="background: var(--accent-blue);">Start Recording</button></div>
                <button class="btn-download" id="dlBtn" style="display:none;" onclick="location.href='/download_csv'">Download CSV</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>